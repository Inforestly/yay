local Players = game:GetService('Players')
local UIS = game:GetService("UserInputService")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild('HumanoidRootPart')
local humanoid = character:WaitForChild('Humanoid')

--// CONFIG
local DELAY_BETWEEN = 3
local WALK_SPEED = 35
local DEFAULT_KEY = Enum.KeyCode.RightShift
local currentKeybind = DEFAULT_KEY
local COLLECT_DISTANCE = 5 -- distance to "collect" PresentRain parts

--// GUI
local screenGui = Instance.new('ScreenGui')
screenGui.Name = 'TeleportGUI'
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild('PlayerGui')

local frame = Instance.new('Frame')
frame.Size = UDim2.new(0, 250, 0, 180)
frame.Position = UDim2.new(0.5, -125, 0.4, -90)
frame.BackgroundColor3 = Color3.fromRGB(25, 25, 45)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true
frame.Parent = screenGui

local frameCorner = Instance.new('UICorner')
frameCorner.CornerRadius = UDim.new(0, 14)
frameCorner.Parent = frame

local frameGradient = Instance.new('UIGradient')
frameGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(40, 40, 70)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(25, 25, 45))
}
frameGradient.Rotation = 45
frameGradient.Parent = frame

-- Start/Stop toggle button
local toggleBtn = Instance.new('TextButton')
toggleBtn.Size = UDim2.new(0.8, 0, 0, 50)
toggleBtn.Position = UDim2.new(0.1, 0, 0.15, 0)
toggleBtn.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextSize = 22
toggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleBtn.Text = "Start"
toggleBtn.TextScaled = true
toggleBtn.Parent = frame

local toggleCorner = Instance.new('UICorner')
toggleCorner.CornerRadius = UDim.new(0, 14)
toggleCorner.Parent = toggleBtn

-- Keybind button
local keybindBtn = Instance.new('TextButton')
keybindBtn.Size = UDim2.new(0.8, 0, 0, 35)
keybindBtn.Position = UDim2.new(0.1, 0, 0.50, 0)
keybindBtn.BackgroundTransparency = 1
keybindBtn.Font = Enum.Font.GothamBold
keybindBtn.TextSize = 18
keybindBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
keybindBtn.Text = "Change Keybind ("..currentKeybind.Name..")"
keybindBtn.TextScaled = true
keybindBtn.Parent = frame

local keyCorner = Instance.new('UICorner')
keyCorner.CornerRadius = UDim.new(0, 12)
keyCorner.Parent = keybindBtn

-- Status label
local status = Instance.new('TextLabel')
status.Size = UDim2.new(0.8, 0, 0, 30)
status.Position = UDim2.new(0.1, 0, 0.70, 0)
status.BackgroundTransparency = 1
status.Font = Enum.Font.GothamBold
status.TextSize = 18
status.TextColor3 = Color3.fromRGB(255, 255, 255)
status.Text = "Status: ðŸŸ  Idle"
status.TextScaled = true
status.TextWrapped = true
status.TextXAlignment = Enum.TextXAlignment.Center
status.TextYAlignment = Enum.TextYAlignment.Center
status.Parent = frame

--// Toggle GUI visibility
UIS.InputBegan:Connect(function(input, gp)
    if not gp and input.KeyCode == currentKeybind then
        frame.Visible = not frame.Visible
    end
end)

--// Find Activation.Root parts in Christmas World
local housesFolder = workspace:WaitForChild("Worlds"):WaitForChild("Christmas World"):WaitForChild("GiveGifts")
local activations = {}
for _, obj in ipairs(housesFolder:GetDescendants()) do
    if obj:IsA("BasePart") and obj.Name == "Root" and obj.Parent and obj.Parent.Name == "Activation" then
        table.insert(activations, obj)
    end
end

--// PresentRain folder
local presentRainFolder = workspace:WaitForChild("Rendered"):WaitForChild("PresentRain")

-- Function to collect a PresentRain part
local function collectPart(part)
    if part and part:IsA("BasePart") then
        hrp.CFrame = part.CFrame + Vector3.new(0, 3, 0)
        task.wait(0.1)
    end
end

--// Loop control
local running = false

local function toggleLoop()
    running = not running

    if running then
        status.Text = "Status: ðŸŸ¢ Running"
        toggleBtn.Text = "Stop"
        toggleBtn.BackgroundColor3 = Color3.fromRGB(255, 60, 60)

        task.spawn(function()
            while running do
                humanoid.WalkSpeed = WALK_SPEED

                -- Collect Christmas World gifts
                for _, rootPart in ipairs(activations) do
                    if not running then break end
                    if rootPart and rootPart.Parent then
                        hrp.CFrame = CFrame.new(rootPart.Position)
                        local waitTime = 0
                        repeat
                            task.wait(0.1)
                            humanoid.WalkSpeed = WALK_SPEED
                            waitTime += 0.1
                        until waitTime >= DELAY_BETWEEN + 1.5 or not running
                    end
                end

                -- Collect PresentRain gifts
                for _, obj in pairs(presentRainFolder:GetChildren()) do
                    if not running then break end
                    if obj:IsA("Model") then
                        for _, part in pairs(obj:GetDescendants()) do
                            if not running then break end
                            collectPart(part)
                            humanoid.WalkSpeed = WALK_SPEED
                        end
                    elseif obj:IsA("BasePart") then
                        collectPart(obj)
                        humanoid.WalkSpeed = WALK_SPEED
                    end
                end

                task.wait(0.1)
            end
        end)
    else
        status.Text = "Status: ðŸŸ  Idle"
        toggleBtn.Text = "Start"
        toggleBtn.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
    end
end

toggleBtn.MouseButton1Click:Connect(toggleLoop)

--// Keybind changer
local waitingForKey = false
keybindBtn.MouseButton1Click:Connect(function()
    waitingForKey = true
    keybindBtn.Text = "Press any key..."
end)

UIS.InputBegan:Connect(function(input, gp)
    if waitingForKey then
        if input.KeyCode ~= Enum.KeyCode.Unknown then
            currentKeybind = input.KeyCode
            waitingForKey = false
            keybindBtn.Text = "Change Keybind ("..currentKeybind.Name..")"
        end
    end
end)
